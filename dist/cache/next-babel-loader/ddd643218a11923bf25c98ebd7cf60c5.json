{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function () { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from 'react';\nimport { classDebounce } from 'hooks/use-debounce';\nimport { __CHANGE_IS_SEEN } from \"../../store/saga\";\nimport { Bus } from \"components/shared/helpers/Bus\";\n\nvar SendIcon = function SendIcon(props) {\n  return __jsx(React.Fragment, null, props.inProcessing ? __jsx(\"div\", {\n    className: \"jsx-148590241\" + \" \" + \"sbl-circ\"\n  }) : props.value ? __jsx(\"img\", {\n    src: \"./assets/images/send.png\",\n    onClick: function onClick() {\n      return props.sendMessage('message');\n    },\n    className: \"jsx-148590241\"\n  }) : __jsx(\"img\", {\n    src: \"./assets/images/key.png\",\n    onClick: function onClick() {\n      return props.sendMessage('key');\n    },\n    className: \"jsx-148590241\"\n  }), __jsx(_JSXStyle, {\n    id: \"148590241\"\n  }, [\".sbl-circ.jsx-148590241{height:22px;width:22px;color:#5a5a5a;position:relative;display:block;border:2px solid;border-radius:50%;border-top-color:transparent;-webkit-animation:rotate-jsx-148590241 1s linear infinite;animation:rotate-jsx-148590241 1s linear infinite;margin:5px 10px 5px 5px;}\", \"@-webkit-keyframes rotate-jsx-148590241{0%{-webkit-transform:rotate(0);-ms-transform:rotate(0);transform:rotate(0);}100%{-webkit-transform:rotate(360deg);-ms-transform:rotate(360deg);transform:rotate(360deg);}}\", \"@keyframes rotate-jsx-148590241{0%{-webkit-transform:rotate(0);-ms-transform:rotate(0);transform:rotate(0);}100%{-webkit-transform:rotate(360deg);-ms-transform:rotate(360deg);transform:rotate(360deg);}}\"]));\n};\n\nvar TextAreaMessage = /*#__PURE__*/function (_React$PureComponent) {\n  _inherits(TextAreaMessage, _React$PureComponent);\n\n  var _super = _createSuper(TextAreaMessage);\n\n  function TextAreaMessage(props) {\n    var _this;\n\n    _classCallCheck(this, TextAreaMessage);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"__debounceTyping\", classDebounce(_this.__isTyping, 600));\n\n    _this.messageArea = React.createRef();\n    _this.state = {\n      messageValue: '',\n      inProcessing: false,\n      editMessage: {\n        index: null,\n        msg: ''\n      }\n    };\n    _this.__debounceTyping = _this.__debounceTyping.bind(_assertThisInitialized(_this));\n    _this.__setMessageValue = _this.__setMessageValue.bind(_assertThisInitialized(_this));\n    _this.__autoSize = _this.__autoSize.bind(_assertThisInitialized(_this));\n    _this.__submitMessage = _this.__submitMessage.bind(_assertThisInitialized(_this));\n    _this.__userIsOnline = _this.__userIsOnline.bind(_assertThisInitialized(_this));\n    _this.__userIsOffline = _this.__userIsOffline.bind(_assertThisInitialized(_this));\n    Bus.subscribe('editMessage', function (_ref) {\n      var msg = _ref.msg,\n          index = _ref.index;\n\n      _this.setState({\n        editMessage: {\n          mainObj: msg,\n          msg: msg === null || msg === void 0 ? void 0 : msg.message,\n          index: index\n        }\n      }, function () {\n        var _this$messageArea$cur;\n\n        return (_this$messageArea$cur = _this.messageArea.current) === null || _this$messageArea$cur === void 0 ? void 0 : _this$messageArea$cur.focus();\n      });\n    });\n    Bus.subscribe('messageSendingFinish', function () {\n      _this.setState({\n        inProcessing: false\n      });\n    });\n    addEventListener('blur', function () {\n      if (_this.state.editMessage.hasOwnProperty('mainObj') && !_this.state.editMessage.msg) {\n        _this.props.isTyping(false);\n      }\n    });\n    return _this;\n  }\n\n  _createClass(TextAreaMessage, [{\n    key: \"__autoSize\",\n    value: function __autoSize() {\n      this.messageArea.current.style.height = 'auto';\n      this.messageArea.current.style.height = this.messageArea.current.scrollHeight + 'px';\n    }\n  }, {\n    key: \"__userIsOffline\",\n    value: function __userIsOffline() {\n      if (this.state.editMessage.hasOwnProperty('mainObj') && !this.state.editMessage.msg) {\n        Bus.dispatch('cancelEditing');\n        this.setState({\n          editMessage: {}\n        });\n      }\n    }\n  }, {\n    key: \"__userIsOnline\",\n    value: function __userIsOnline() {\n      var _this$props$activeUse, _this$props$activeUse2;\n\n      if (((_this$props$activeUse = this.props.activeUser) === null || _this$props$activeUse === void 0 ? void 0 : _this$props$activeUse.id) && this.props.loggedUserId && !((_this$props$activeUse2 = this.props.activeUser) === null || _this$props$activeUse2 === void 0 ? void 0 : _this$props$activeUse2.isSender)) {\n        var _this$props$activeUse3;\n\n        __CHANGE_IS_SEEN({\n          senderID: (_this$props$activeUse3 = this.props.activeUser) === null || _this$props$activeUse3 === void 0 ? void 0 : _this$props$activeUse3.id,\n          myID: this.props.loggedUserId\n        }).next();\n      }\n    }\n  }, {\n    key: \"__isTyping\",\n    value: function __isTyping() {\n      if (this.state.messageValue !== '' && !this.state.editMessage.msg) {\n        this.props.isTyping(true);\n      }\n    }\n  }, {\n    key: \"__submitMessage\",\n    value: function __submitMessage(evt) {\n      var _this2 = this;\n\n      if (evt.key === 'Enter' && evt.shiftKey) {\n        return;\n      }\n\n      if (evt === 'key') {\n        this.props.sendMessage('key', true);\n        this.setState({\n          inProcessing: true\n        });\n      } else if (evt === 'message' || evt.key === 'Enter') {\n        this.setState({\n          inProcessing: true\n        });\n\n        if (this.state.editMessage.msg) {\n          this.props.sendMessage(this.state.editMessage.msg, this.state.editMessage);\n        } else if (this.state.messageValue !== '') {\n          this.props.sendMessage(this.state.messageValue);\n        }\n\n        this.messageArea.current.blur();\n        this.setState({\n          editMessage: {},\n          messageValue: ''\n        }, function () {\n          _this2.messageArea.current.style.height = 'auto';\n        });\n        evt.key && evt.preventDefault();\n      }\n    }\n  }, {\n    key: \"__setMessageValue\",\n    value: function __setMessageValue(evt) {\n      var _this3 = this;\n\n      this.setState(_objectSpread({}, this.state.editMessage.msg && {\n        editMessage: _objectSpread({}, this.state.editMessage, {\n          msg: evt.target.value\n        })\n      }, {\n        messageValue: evt.target.value\n      }), function () {\n        if (_this3.state.messageValue === '' && !_this3.state.editMessage.msg) {\n          _this3.props.isTyping(false);\n        }\n      });\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      Bus.unsubscribe('editMessage');\n      Bus.unsubscribe('messageSendingFinish');\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      return __jsx(React.Fragment, null, __jsx(\"div\", {\n        className: \"jsx-1746285459\" + \" \" + \"message-send-container\"\n      }, __jsx(\"textarea\", {\n        ref: this.messageArea,\n        value: this.state.editMessage.msg || this.state.messageValue,\n        rows: this.state.rowLineCount,\n        onFocus: this.__userIsOnline,\n        onBlur: this.__userIsOffline,\n        onInput: this.__autoSize,\n        onChange: function onChange(evt) {\n          _this4.__setMessageValue(evt);\n\n          _this4.__debounceTyping();\n        },\n        placeholder: \"Type message...\",\n        onKeyDown: this.__submitMessage,\n        className: \"jsx-1746285459\"\n      }), __jsx(SendIcon, {\n        inProcessing: this.state.inProcessing,\n        sendMessage: this.__submitMessage,\n        value: this.state.messageValue\n      })), __jsx(_JSXStyle, {\n        id: \"1746285459\"\n      }, [\".message-send-container{padding-left:3px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;border-top:1px solid rgb(227,222,222);-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}\", \".message-send-container img{width:25px;height:25px;margin-right:7px;cursor:pointer;}\", \".message-send-container textarea{resize:none;max-height:70px;width:calc(100% - 30px);border:none;outline:none;}\", \".message-send-container textarea::-webkit-scrollbar{width:0px;height:10px;}\", \".message-send-container textarea::-webkit-scrollbar-thumb{background:transparent;}\", \".message-send-container textarea::-webkit-scrollbar-track{background:transparent;}\"]));\n    }\n  }]);\n\n  return TextAreaMessage;\n}(React.PureComponent);\n\nexport default TextAreaMessage;","map":null,"metadata":{},"sourceType":"module"}